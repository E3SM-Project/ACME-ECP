module micro_params

  use grid, only: nzm
  use params, only: crm_rknd

  implicit none

  !  Microphysics stuff:

  ! Densities of hydrometeors

  real(crm_rknd), parameter :: rhor = 1000. ! Density of water, kg/m3
  real(crm_rknd), parameter :: rhos = 100.  ! Density of snow, kg/m3
  real(crm_rknd), parameter :: rhog = 400.  ! Density of graupel, kg/m3
  !real(crm_rknd), parameter :: rhog = 917.  ! hail - Lin 1983

  ! Temperatures limits for various hydrometeors

  real(crm_rknd), parameter :: tbgmin = 253.16    ! Minimum temperature for cloud water., K
  real(crm_rknd), parameter :: tbgmax = 273.16    ! Maximum temperature for cloud ice, K
  real(crm_rknd), parameter :: tprmin = 268.16    ! Minimum temperature for rain, K
  real(crm_rknd), parameter :: tprmax = 283.16    ! Maximum temperature for snow+graupel, K
  real(crm_rknd), parameter :: tgrmin = 223.16    ! Minimum temperature for snow, K
  real(crm_rknd), parameter :: tgrmax = 283.16    ! Maximum temperature for graupel, K

  ! Terminal velocity coefficients

  ! real(crm_rknd), parameter :: a_rain = 842. ! Coeff.for rain term vel
  ! real(crm_rknd), parameter :: b_rain = 0.8  ! Fall speed exponent for rain
  ! real(crm_rknd), parameter :: a_snow = 4.84 ! Coeff.for snow term vel
  ! real(crm_rknd), parameter :: b_snow = 0.25 ! Fall speed exponent for snow
  ! !!!real(crm_rknd), parameter :: a_grau = 40.7! Krueger (1994) ! Coef. for graupel term vel
  ! real(crm_rknd), parameter :: a_grau = 94.5 ! Lin (1983) (rhog=400)
  ! !!!real(crm_rknd), parameter :: a_grau = 127.94! Lin (1983) (rhog=917)
  ! real(crm_rknd), parameter :: b_grau = 0.5  ! Fall speed exponent for graupel

  ! Autoconversion
! #ifdef CLUBB_CRM   /*microphysical tuning for CLUBB*/
!   real(crm_rknd), parameter :: qcw0 = 0.6e-3      ! Threshold for water autoconversion, g/g
!   real(crm_rknd), parameter :: qci0 = 1.e-4     ! Threshold for ice autoconversion, g/g
!   real(crm_rknd), parameter :: alphaelq = 10.e-3  ! autoconversion of cloud water rate coef
!   real(crm_rknd), parameter :: betaelq = 6.0e-3   ! autoconversion of cloud ice rate coef
! #else
!   real(crm_rknd), parameter :: qcw0 = 1.e-3      ! Threshold for water autoconversion, g/g
!   real(crm_rknd), parameter :: qci0 = 1.e-4     ! Threshold for ice autoconversion, g/g
!   real(crm_rknd), parameter :: alphaelq = 1.e-3  ! autoconversion of cloud water rate coef
!   real(crm_rknd), parameter :: betaelq = 1.e-3   ! autoconversion of cloud ice rate coef
! #endif /*CLUBB_CRM*/

! #if defined( SP_LOWER_ICE_AUTOCONV )
!   real(crm_rknd), parameter :: qci0 = 1.e-6     ! Threshold for ice autoconversion, g/g
! #else
!   real(crm_rknd), parameter :: qci0 = 1.e-4     ! Threshold for ice autoconversion, g/g
! #endif

#if defined( SP_TUNING_A )  /* Decrease threshold for ice and water autoconversion */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 842. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.8  ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 4.84 ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.25 ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 94.5 ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.5  ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-4      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-6      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 1.e-3  ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq = 1.e-3   ! autoconversion of cloud ice rate coef
#elif defined( SP_TUNING_B )  /* Increase water and ice autoconversion rate coeff */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 842. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.8  ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 4.84 ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.25 ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 94.5 ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.5  ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-3      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-4      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 10.e-3 ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq = 10.e-3  ! autoconversion of cloud ice rate coef
#elif defined( SP_TUNING_C )  /* Combine A and B */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 842. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.8  ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 4.84 ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.25 ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 94.5 ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.5  ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-4      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-6      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 10.e-3 ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq = 10.e-3  ! autoconversion of cloud ice rate coef
#elif defined( SP_TUNING_D )  /* larger fall speed parameters */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 1000. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.9   ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 5.    ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.3   ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 100   ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.8   ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-3      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-4      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 1.e-3  ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq = 1.e-3   ! autoconversion of cloud ice rate coef
#elif defined( SP_TUNING_E )  /* C + D */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 1000. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.9   ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 5.    ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.3   ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 100   ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.8   ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-4      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-6      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 10.e-3 ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq = 10.e-3  ! autoconversion of cloud ice rate coef
#elif defined( SP_TUNING_F )  /* B + D (...and then some - autoconv threshold stay at defaults) */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 1100. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.99  ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 6.    ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.4   ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 100   ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.9   ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-3      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-4      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 20.e-3 ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq  = 30.e-3 ! autoconversion of cloud ice rate coef
#else /* Default vales */
  ! Terminal velocity coefficients
  real(crm_rknd), parameter :: a_rain = 842. ! Coeff.for rain term vel
  real(crm_rknd), parameter :: b_rain = 0.8  ! Fall speed exponent for rain
  real(crm_rknd), parameter :: a_snow = 4.84 ! Coeff.for snow term vel
  real(crm_rknd), parameter :: b_snow = 0.25 ! Fall speed exponent for snow
  real(crm_rknd), parameter :: a_grau = 94.5 ! Coeff.for graupel term vel
  real(crm_rknd), parameter :: b_grau = 0.5  ! Fall speed exponent for graupel
  ! Autoconversion
  real(crm_rknd), parameter :: qcw0 = 1.e-3      ! Threshold for water autoconversion, g/g
  real(crm_rknd), parameter :: qci0 = 1.e-4      ! Threshold for ice autoconversion, g/g
  real(crm_rknd), parameter :: alphaelq = 1.e-3  ! autoconversion of cloud water rate coef
  real(crm_rknd), parameter :: betaelq = 1.e-3   ! autoconversion of cloud ice rate coef
#endif

  ! Accretion

  real(crm_rknd), parameter :: erccoef = 1.0   ! Rain/Cloud water collection efficiency
  real(crm_rknd), parameter :: esccoef = 1.0   ! Snow/Cloud water collection efficiency
  real(crm_rknd), parameter :: esicoef = 0.1   ! Snow/cloud ice collection efficiency
  real(crm_rknd), parameter :: egccoef = 1.0   ! Graupel/Cloud water collection efficiency
  real(crm_rknd), parameter :: egicoef = 0.1   ! Graupel/Cloud ice collection efficiency

  ! Interseption parameters for exponential size spectra

  real(crm_rknd), parameter :: nzeror = 8.e6   ! Intercept coeff. for rain
  real(crm_rknd), parameter :: nzeros = 3.e6   ! Intersept coeff. for snow
  real(crm_rknd), parameter :: nzerog = 4.e6   ! Intersept coeff. for graupel
  !real(crm_rknd), parameter :: nzerog = 4.e4   ! hail - Lin 1993

  real(crm_rknd), parameter :: qp_threshold = 1.e-8 ! minimal rain/snow water content


  ! Misc. microphysics variables

  real*4 gam3       ! Gamma function of 3
  real*4 gams1      ! Gamma function of (3 + b_snow)
  real*4 gams2      ! Gamma function of (5 + b_snow)/2
  real*4 gams3      ! Gamma function of (4 + b_snow)
  real*4 gamg1      ! Gamma function of (3 + b_grau)
  real*4 gamg2      ! Gamma function of (5 + b_grau)/2
  real*4 gamg3      ! Gamma function of (4 + b_grau)
  real*4 gamr1      ! Gamma function of (3 + b_rain)
  real*4 gamr2      ! Gamma function of (5 + b_rain)/2
  real*4 gamr3      ! Gamma function of (4 + b_rain)

  real(crm_rknd) accrsc(nzm),accrsi(nzm),accrrc(nzm),coefice(nzm)
  real(crm_rknd) accrgc(nzm),accrgi(nzm)
  real(crm_rknd) evaps1(nzm),evaps2(nzm),evapr1(nzm),evapr2(nzm)
  real(crm_rknd) evapg1(nzm),evapg2(nzm)

  real(crm_rknd) a_bg, a_pr, a_gr


end module micro_params
